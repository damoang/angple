openapi: 3.0.3
info:
  title: Angple API
  description: |
    Angple 커뮤니티 플랫폼 REST API.

    ## 인증
    대부분의 쓰기 API는 Bearer 토큰 인증이 필요합니다.
    `POST /api/v2/auth/login`으로 로그인 후 `access_token`을 받아 `Authorization: Bearer {token}` 헤더에 포함하세요.

    ## API 버전
    - **v1** (`/api/v1/`): 콘텐츠 관련 엔드포인트 (게시판, 게시글, 댓글, 파일 등)
    - **v2** (`/api/v2/`): 인증 및 최신 엔드포인트

    ## 페이지네이션
    목록 API는 `page`와 `limit` 쿼리 파라미터를 지원합니다.
    응답에 `total`, `total_pages`, `page`, `limit` 필드가 포함됩니다.
  version: 0.1.0
  contact:
    name: Angple Team
    url: https://github.com/damoang/angple
  license:
    name: MIT

servers:
  - url: /
    description: Current server

tags:
  - name: Auth
    description: 인증 (로그인, 토큰 갱신, OAuth)
  - name: Boards
    description: 게시판 관리
  - name: Posts
    description: 게시글 CRUD
  - name: Comments
    description: 댓글 CRUD
  - name: Likes
    description: 좋아요/싫어요
  - name: Search
    description: 검색
  - name: Members
    description: 회원 프로필
  - name: My
    description: 내 정보 (인증 필요)
  - name: Files
    description: 파일 업로드
  - name: Notifications
    description: 알림
  - name: Messages
    description: 쪽지
  - name: Points
    description: 포인트
  - name: Admin
    description: 관리자 기능

paths:
  # ─── Auth ───
  /api/v2/auth/login:
    post:
      tags: [Auth]
      summary: 로그인
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, password]
              properties:
                username:
                  type: string
                password:
                  type: string
      responses:
        '200':
          description: 로그인 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'

  /api/v1/auth/refresh:
    post:
      tags: [Auth]
      summary: 토큰 갱신
      description: refresh_token 쿠키를 이용하여 access_token을 갱신합니다.
      responses:
        '200':
          description: 갱신 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'

  /api/v1/auth/logout:
    post:
      tags: [Auth]
      summary: 로그아웃
      responses:
        '200':
          description: 로그아웃 성공

  /api/v1/auth/profile:
    get:
      tags: [Auth]
      summary: 현재 유저 프로필 (JWT)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 프로필 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

  /api/v1/auth/oauth/{provider}:
    get:
      tags: [Auth]
      summary: OAuth 로그인 URL
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
            enum: [google, kakao, naver, github]
      responses:
        '302':
          description: OAuth 제공자로 리다이렉트

  # ─── Boards ───
  /api/v1/boards/{boardId}:
    get:
      tags: [Boards]
      summary: 게시판 정보 조회
      parameters:
        - $ref: '#/components/parameters/boardId'
      responses:
        '200':
          description: 게시판 정보
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Board'

  /api/v1/board-groups:
    get:
      tags: [Boards]
      summary: 게시판 그룹 목록 (게시판 포함)
      responses:
        '200':
          description: 그룹 목록
          content:
            application/json:
              schema:
                type: object
                properties:
                  groups:
                    type: array
                    items:
                      $ref: '#/components/schemas/BoardGroup'

  # ─── Posts ───
  /api/v1/boards/{boardId}/posts:
    get:
      tags: [Posts]
      summary: 게시글 목록 조회
      parameters:
        - $ref: '#/components/parameters/boardId'
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/limit'
        - name: sfl
          in: query
          schema:
            type: string
            enum: [wr_subject, wr_content, wr_name, mb_id]
          description: 검색 필드
        - name: stx
          in: query
          schema:
            type: string
          description: 검색어
        - name: tag
          in: query
          schema:
            type: string
          description: 태그 필터
      responses:
        '200':
          description: 게시글 목록
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedPosts'
    post:
      tags: [Posts]
      summary: 게시글 작성
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/boardId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePostRequest'
      responses:
        '201':
          description: 게시글 생성 성공

  /api/v1/boards/{boardId}/posts/{postId}:
    get:
      tags: [Posts]
      summary: 게시글 상세 조회
      parameters:
        - $ref: '#/components/parameters/boardId'
        - $ref: '#/components/parameters/postId'
      responses:
        '200':
          description: 게시글 상세
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post'
    put:
      tags: [Posts]
      summary: 게시글 수정
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/boardId'
        - $ref: '#/components/parameters/postId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePostRequest'
      responses:
        '200':
          description: 수정 성공

  /api/v1/boards/{boardId}/posts/{postId}/notice:
    patch:
      tags: [Posts]
      summary: 공지 상태 토글
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/boardId'
        - $ref: '#/components/parameters/postId'
      responses:
        '200':
          description: 토글 성공

  /api/v1/boards/{boardId}/posts/{postId}/soft-delete:
    patch:
      tags: [Posts]
      summary: 게시글 소프트 삭제
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/boardId'
        - $ref: '#/components/parameters/postId'
      responses:
        '200':
          description: 소프트 삭제 성공

  /api/v1/boards/{boardId}/posts/{postId}/restore:
    post:
      tags: [Posts, Admin]
      summary: 삭제된 게시글 복원
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/boardId'
        - $ref: '#/components/parameters/postId'
      responses:
        '200':
          description: 복원 성공

  # ─── Comments ───
  /api/v1/boards/{boardId}/posts/{postId}/comments:
    get:
      tags: [Comments]
      summary: 댓글 목록 조회
      parameters:
        - $ref: '#/components/parameters/boardId'
        - $ref: '#/components/parameters/postId'
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/limit'
      responses:
        '200':
          description: 댓글 목록
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedComments'
    post:
      tags: [Comments]
      summary: 댓글 작성
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/boardId'
        - $ref: '#/components/parameters/postId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCommentRequest'
      responses:
        '201':
          description: 댓글 생성 성공

  /api/v1/boards/{boardId}/posts/{postId}/comments/{commentId}:
    put:
      tags: [Comments]
      summary: 댓글 수정
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/boardId'
        - $ref: '#/components/parameters/postId'
        - $ref: '#/components/parameters/commentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCommentRequest'
      responses:
        '200':
          description: 수정 성공
    delete:
      tags: [Comments]
      summary: 댓글 삭제
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/boardId'
        - $ref: '#/components/parameters/postId'
        - $ref: '#/components/parameters/commentId'
      responses:
        '200':
          description: 삭제 성공

  # ─── Likes ───
  /api/v1/boards/{boardId}/posts/{postId}/like:
    post:
      tags: [Likes]
      summary: 게시글 좋아요
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/boardId'
        - $ref: '#/components/parameters/postId'
      responses:
        '200':
          description: 좋아요 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LikeResponse'

  /api/v1/boards/{boardId}/posts/{postId}/dislike:
    post:
      tags: [Likes]
      summary: 게시글 싫어요
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/boardId'
        - $ref: '#/components/parameters/postId'
      responses:
        '200':
          description: 싫어요 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LikeResponse'

  /api/v1/boards/{boardId}/posts/{postId}/like-status:
    get:
      tags: [Likes]
      summary: 좋아요/싫어요 상태 조회
      parameters:
        - $ref: '#/components/parameters/boardId'
        - $ref: '#/components/parameters/postId'
      responses:
        '200':
          description: 상태 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LikeResponse'

  # ─── Search ───
  /api/v1/search:
    get:
      tags: [Search]
      summary: 전체 게시판 통합 검색
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
        - name: sfl
          in: query
          schema:
            type: string
        - $ref: '#/components/parameters/limit'
      responses:
        '200':
          description: 검색 결과
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedPosts'

  # ─── Members ───
  /api/v1/members/{memberId}:
    get:
      tags: [Members]
      summary: 회원 프로필 조회
      parameters:
        - name: memberId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 프로필 조회 성공

  # ─── My ───
  /api/v1/my/posts:
    get:
      tags: [My]
      summary: 내 게시글 목록
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/limit'
      responses:
        '200':
          description: 내 게시글
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedPosts'

  /api/v1/my/comments:
    get:
      tags: [My]
      summary: 내 댓글 목록
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/limit'
      responses:
        '200':
          description: 내 댓글

  /api/v1/my/scraps:
    get:
      tags: [My]
      summary: 내 스크랩 목록
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/limit'
      responses:
        '200':
          description: 스크랩 목록

  /api/v1/my/point:
    get:
      tags: [Points]
      summary: 내 포인트 조회
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 포인트 요약
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PointSummary'

  /api/v1/my/point/history:
    get:
      tags: [Points]
      summary: 포인트 이력
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/limit'
      responses:
        '200':
          description: 포인트 이력

  /api/v1/my/blocked:
    get:
      tags: [My]
      summary: 차단 회원 목록
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 차단 목록

  /api/v1/members/{memberId}/block:
    post:
      tags: [My]
      summary: 회원 차단
      security:
        - bearerAuth: []
      parameters:
        - name: memberId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 차단 성공
    delete:
      tags: [My]
      summary: 회원 차단 해제
      security:
        - bearerAuth: []
      parameters:
        - name: memberId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 차단 해제 성공

  # ─── Scraps ───
  /api/v1/posts/{postId}/scrap:
    post:
      tags: [My]
      summary: 스크랩 추가
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/postId'
      responses:
        '200':
          description: 스크랩 추가 성공
    delete:
      tags: [My]
      summary: 스크랩 삭제
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/postId'
      responses:
        '200':
          description: 스크랩 삭제 성공

  # ─── Files ───
  /api/v2/media/attachments:
    post:
      tags: [Files]
      summary: 파일 업로드
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: 업로드 성공

  /api/v2/media/images:
    post:
      tags: [Files]
      summary: 이미지 업로드
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: 업로드 성공

  # ─── Notifications ───
  /api/v1/notifications:
    get:
      tags: [Notifications]
      summary: 알림 목록 조회
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/limit'
      responses:
        '200':
          description: 알림 목록
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationList'

  /api/v1/notifications/unread-count:
    get:
      tags: [Notifications]
      summary: 읽지 않은 알림 수
      responses:
        '200':
          description: 카운트
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer

  /api/v1/notifications/{notificationId}/read:
    post:
      tags: [Notifications]
      summary: 알림 읽음 처리
      parameters:
        - name: notificationId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 읽음 처리 성공

  /api/v1/notifications/read-all:
    post:
      tags: [Notifications]
      summary: 모든 알림 읽음 처리
      responses:
        '200':
          description: 처리 성공

  # ─── Messages ───
  /api/v1/messages:
    get:
      tags: [Messages]
      summary: 쪽지 목록
      parameters:
        - name: kind
          in: query
          schema:
            type: string
            enum: [recv, send]
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/limit'
      responses:
        '200':
          description: 쪽지 목록
    post:
      tags: [Messages]
      summary: 쪽지 보내기
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SendMessageRequest'
      responses:
        '200':
          description: 전송 성공

  /api/v1/messages/unread-count:
    get:
      tags: [Messages]
      summary: 읽지 않은 쪽지 수
      responses:
        '200':
          description: 카운트

  /api/v1/messages/{messageId}:
    get:
      tags: [Messages]
      summary: 쪽지 상세 조회
      parameters:
        - name: messageId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 쪽지 상세
    delete:
      tags: [Messages]
      summary: 쪽지 삭제
      parameters:
        - name: messageId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 삭제 성공

  # ─── Post Revisions ───
  /api/v1/boards/{boardId}/posts/{postId}/revisions:
    get:
      tags: [Posts]
      summary: 게시글 수정 이력 조회
      parameters:
        - $ref: '#/components/parameters/boardId'
        - $ref: '#/components/parameters/postId'
      responses:
        '200':
          description: 수정 이력 목록

  # ─── Reports ───
  /api/v1/boards/{boardId}/posts/{postId}/report:
    post:
      tags: [Posts]
      summary: 게시글 신고
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/boardId'
        - $ref: '#/components/parameters/postId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReportRequest'
      responses:
        '200':
          description: 신고 접수 성공

  # ─── Admin ───
  /api/v1/boards/{boardId}/posts/bulk-delete:
    post:
      tags: [Admin]
      summary: 게시글 일괄 삭제
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/boardId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                postIds:
                  type: array
                  items:
                    type: integer
      responses:
        '200':
          description: 삭제 성공

  /api/v1/boards/{boardId}/posts/bulk-move:
    post:
      tags: [Admin]
      summary: 게시글 일괄 이동
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/boardId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                postIds:
                  type: array
                  items:
                    type: integer
                targetBoardId:
                  type: string
      responses:
        '200':
          description: 이동 성공

  /api/v1/admin/posts/deleted:
    get:
      tags: [Admin]
      summary: 삭제된 게시글 목록 (관리자)
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/limit'
      responses:
        '200':
          description: 삭제 게시글 목록

  # ─── Menu & Widgets ───
  /api/v1/menus/sidebar:
    get:
      tags: [Boards]
      summary: 사이드바 메뉴 조회
      responses:
        '200':
          description: 메뉴 데이터

  /api/v1/recommended/ai/{period}:
    get:
      tags: [Posts]
      summary: AI 추천 게시글
      parameters:
        - name: period
          in: path
          required: true
          schema:
            type: string
            enum: [daily, weekly, monthly]
      responses:
        '200':
          description: 추천 게시글 목록

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    boardId:
      name: boardId
      in: path
      required: true
      schema:
        type: string
      description: 게시판 ID
    postId:
      name: postId
      in: path
      required: true
      schema:
        type: integer
      description: 게시글 번호
    commentId:
      name: commentId
      in: path
      required: true
      schema:
        type: integer
      description: 댓글 번호
    page:
      name: page
      in: query
      schema:
        type: integer
        default: 1
      description: 페이지 번호
    limit:
      name: limit
      in: query
      schema:
        type: integer
        default: 20
      description: 한 페이지당 항목 수

  schemas:
    User:
      type: object
      properties:
        mb_id:
          type: string
        mb_name:
          type: string
        mb_nick:
          type: string
        mb_email:
          type: string
        mb_level:
          type: integer
        mb_point:
          type: integer
        mb_profile_image:
          type: string
          nullable: true

    LoginResponse:
      type: object
      properties:
        access_token:
          type: string
        expires_in:
          type: integer
        token_type:
          type: string
          example: Bearer
        user:
          $ref: '#/components/schemas/User'

    Board:
      type: object
      properties:
        bo_table:
          type: string
        bo_subject:
          type: string
        bo_skin:
          type: string
        bo_write_level:
          type: integer
        bo_read_level:
          type: integer
        bo_list_level:
          type: integer
        bo_comment_level:
          type: integer

    BoardGroup:
      type: object
      properties:
        gr_id:
          type: string
        gr_subject:
          type: string
        boards:
          type: array
          items:
            $ref: '#/components/schemas/Board'

    Post:
      type: object
      properties:
        wr_id:
          type: integer
        bo_table:
          type: string
        wr_subject:
          type: string
        wr_content:
          type: string
        wr_name:
          type: string
        mb_id:
          type: string
        wr_datetime:
          type: string
          format: date-time
        wr_hit:
          type: integer
        wr_good:
          type: integer
        wr_nogood:
          type: integer
        wr_comment:
          type: integer
        ca_name:
          type: string
        is_notice:
          type: boolean
        tags:
          type: array
          items:
            type: string
        extra_1:
          type: string
        extra_2:
          type: string
        extra_3:
          type: string
        extra_4:
          type: string
        extra_5:
          type: string

    PaginatedPosts:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Post'
        total:
          type: integer
        page:
          type: integer
        limit:
          type: integer
        total_pages:
          type: integer

    Comment:
      type: object
      properties:
        wr_id:
          type: integer
        wr_content:
          type: string
        wr_name:
          type: string
        mb_id:
          type: string
        wr_datetime:
          type: string
          format: date-time
        wr_good:
          type: integer
        wr_nogood:
          type: integer
        wr_parent:
          type: integer
          description: 부모 댓글 ID (대댓글인 경우)

    PaginatedComments:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Comment'
        total:
          type: integer
        page:
          type: integer
        limit:
          type: integer

    CreatePostRequest:
      type: object
      required: [wr_subject, wr_content]
      properties:
        wr_subject:
          type: string
          description: 제목
        wr_content:
          type: string
          description: 내용 (HTML)
        ca_name:
          type: string
          description: 카테고리
        tags:
          type: array
          items:
            type: string
        wr_link1:
          type: string
        wr_link2:
          type: string

    UpdatePostRequest:
      type: object
      properties:
        wr_subject:
          type: string
        wr_content:
          type: string
        ca_name:
          type: string
        tags:
          type: array
          items:
            type: string

    CreateCommentRequest:
      type: object
      required: [wr_content]
      properties:
        wr_content:
          type: string
        wr_parent:
          type: integer
          description: 부모 댓글 ID (대댓글인 경우)

    UpdateCommentRequest:
      type: object
      required: [wr_content]
      properties:
        wr_content:
          type: string

    LikeResponse:
      type: object
      properties:
        likes:
          type: integer
        dislikes:
          type: integer
        user_liked:
          type: boolean
        user_disliked:
          type: boolean

    PointSummary:
      type: object
      properties:
        total:
          type: integer
        today:
          type: integer
        month:
          type: integer

    NotificationList:
      type: object
      properties:
        items:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              type:
                type: string
              message:
                type: string
              read:
                type: boolean
              created_at:
                type: string
                format: date-time
        total:
          type: integer
        unread_count:
          type: integer

    SendMessageRequest:
      type: object
      required: [receiver_id, content]
      properties:
        receiver_id:
          type: string
        content:
          type: string

    ReportRequest:
      type: object
      required: [reason]
      properties:
        reason:
          type: integer
          description: 신고 사유 코드 (1-15)
        detail:
          type: string
          description: 상세 내용
