# ë³´ì•ˆ ì¸ì¦ ì‹œìŠ¤í…œ ì¢…í•© ë¶„ì„ ë¦¬í¬íŠ¸

**ì‘ì„±ì¼**: 2024ë…„ 12ì›” 29ì¼
**í”„ë¡œì íŠ¸**: Angple (ë‹¤ëª¨ì•™ ì»¤ë®¤ë‹ˆí‹° í”Œë«í¼)
**ëª©ì **: ì¥ê¸° ìœ ì§€ë³´ìˆ˜ ë° ë³´ì•ˆì„ ê³ ë ¤í•œ ìµœì ì˜ ì¸ì¦ ì•„í‚¤í…ì²˜ ì„¤ê³„

---

## ëª©ì°¨

1. [ì¡°ì‚¬ ë°°ê²½ ë° ëª©ì ](#1-ì¡°ì‚¬-ë°°ê²½-ë°-ëª©ì )
2. [í˜„ì¬ ì‹œìŠ¤í…œ ë¶„ì„](#2-í˜„ì¬-ì‹œìŠ¤í…œ-ë¶„ì„)
3. [OWASP ë° ì—…ê³„ Best Practice](#3-owasp-ë°-ì—…ê³„-best-practice)
4. [ë³´ì•ˆ ì·¨ì•½ì  ë¶„ì„ (CVE ì‚¬ë¡€)](#4-ë³´ì•ˆ-ì·¨ì•½ì -ë¶„ì„-cve-ì‚¬ë¡€)
5. [í† í° ì €ì¥ ë°©ì‹ ë¹„êµ](#5-í† í°-ì €ì¥-ë°©ì‹-ë¹„êµ)
6. [ëŒ€ê¸°ì—… ì‚¬ë¡€ ë¶„ì„](#6-ëŒ€ê¸°ì—…-ì‚¬ë¡€-ë¶„ì„)
7. [SvelteKit íŠ¹í™” ê³ ë ¤ì‚¬í•­](#7-sveltekit-íŠ¹í™”-ê³ ë ¤ì‚¬í•­)
8. [ì•„í‚¤í…ì²˜ ì˜µì…˜ ë¹„êµ](#8-ì•„í‚¤í…ì²˜-ì˜µì…˜-ë¹„êµ)
9. [ìµœì¢… ì¶”ì²œì•ˆ (3ê°€ì§€ ì˜µì…˜)](#9-ìµœì¢…-ì¶”ì²œì•ˆ-3ê°€ì§€-ì˜µì…˜)
10. [êµ¬í˜„ ë¡œë“œë§µ](#10-êµ¬í˜„-ë¡œë“œë§µ)

---

## 1. ì¡°ì‚¬ ë°°ê²½ ë° ëª©ì 

### 1.1 í˜„ì¬ ë¬¸ì œì 

-   **XSS ì·¨ì•½ì **: localStorageì— accessToken ì €ì¥ â†’ JavaScriptë¡œ ì ‘ê·¼ ê°€ëŠ¥
-   **ì¥ê¸° í† í° ë…¸ì¶œ**: refreshTokenë„ localStorageì— ì €ì¥
-   **CSRF ë°©ì–´ ë¶€ì¬**: ì¿ í‚¤ ê¸°ë°˜ì´ ì•„ë‹ˆë¯€ë¡œ CSRF í† í° ë¶ˆí•„ìš”í•˜ì§€ë§Œ, ì´ëŠ” localStorageì˜ ë¶€ìˆ˜ íš¨ê³¼ì¼ ë¿

### 1.2 ì¡°ì‚¬ ëª©ì 

-   **ì¦‰ê°ì ì¸ í•´ê²°ì±…ì´ ì•„ë‹Œ ê·¼ë³¸ì ì¸ ì„¤ê³„** ê²€í† 
-   **10ë…„ í›„ì—ë„ ìœ ì§€ë³´ìˆ˜ ê°€ëŠ¥í•œ** ì•„í‚¤í…ì²˜ ì„ ì •
-   **ëŒ€ê¸°ì—… ìˆ˜ì¤€ì˜ ë³´ì•ˆ í‘œì¤€** ì ìš©
-   **ì„±ëŠ¥ê³¼ ë³´ì•ˆì˜ ê· í˜•ì ** ì°¾ê¸°

---

## 2. í˜„ì¬ ì‹œìŠ¤í…œ ë¶„ì„

### 2.1 í”„ë¡ íŠ¸ì—”ë“œ (SvelteKit)

**íŒŒì¼**: `apps/web/src/lib/api/client.ts`

```typescript
// âŒ í˜„ì¬ êµ¬í˜„: localStorage ì‚¬ìš©
private loadToken(): void {
    const savedToken = localStorage.getItem('damoang_api_token');
    const savedExpiry = localStorage.getItem('damoang_api_token_expiry');
    // ...
}

private saveToken(token: string, expiresAt: string): void {
    this.token = token;
    this.tokenExpiry = new Date(expiresAt);

    if (typeof window !== 'undefined') {
        localStorage.setItem('damoang_api_token', token);
        localStorage.setItem('damoang_api_token_expiry', expiresAt);
    }
}
```

**ë¬¸ì œì **:

1. XSS ê³µê²© ì‹œ í† í° íƒˆì·¨ ê°€ëŠ¥
2. ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ì—ì„œ í† í° ë…¸ì¶œ
3. í† í° ì¦‰ì‹œ ë¬´íš¨í™” ë¶ˆê°€ëŠ¥ (stateless JWT)

### 2.2 ë°±ì—”ë“œ (Go + Fiber)

**íŒŒì¼**: `internal/handler/auth_handler.go`, `internal/middleware/cookie_auth.go`

**âœ… ì´ë¯¸ êµ¬í˜„ëœ ê²ƒ**:

-   `DamoangCookieAuth` ë¯¸ë“¤ì›¨ì–´ â†’ `damoang_jwt` ì¿ í‚¤ ì½ê¸°
-   JWT ìƒì„±/ê²€ì¦ ë¡œì§ ì™„ë¹„
-   Clean Architecture êµ¬ì¡°

**âŒ ëˆ„ë½ëœ ê²ƒ**:

-   ë¡œê·¸ì¸/ë¦¬í”„ë ˆì‹œ ì—”ë“œí¬ì¸íŠ¸ì—ì„œ httpOnly ì¿ í‚¤ ì„¤ì • ì•ˆ í•¨
-   JSON bodyë¡œ refreshToken ì „ì†¡ (ì¿ í‚¤ ë¯¸ì‚¬ìš©)
-   ë¡œê·¸ì•„ì›ƒ ì—”ë“œí¬ì¸íŠ¸ ì—†ìŒ

### 2.3 ì¸í”„ë¼

-   **ë°ì´í„°ë² ì´ìŠ¤**: MySQL 8.0+ (ê·¸ëˆ„ë³´ë“œ í˜¸í™˜)
-   **ìºì‹œ**: Redis 7+ (í˜„ì¬ëŠ” ì—°ê²°ë§Œ ìˆ˜ë¦½)
-   **ë™ì‹œ ì ‘ì† ëª©í‘œ**: 7,000~20,000ëª…
-   **ì‘ë‹µ ì‹œê°„ ëª©í‘œ**: 50ms ì´í•˜

---

## 3. OWASP ë° ì—…ê³„ Best Practice

### 3.1 OWASP JWT ë³´ì•ˆ ê¶Œê³ ì‚¬í•­ (2024)

ì¶œì²˜: [OWASP Cheat Sheet Series](https://cheatsheetseries.owasp.org/cheatsheets/JSON_Web_Token_for_Java_Cheat_Sheet.html)

#### âœ… í•„ìˆ˜ êµ¬í˜„ ì‚¬í•­

1. **ì•Œê³ ë¦¬ì¦˜ ê²€ì¦**: `{"alg":"none"}` ê¸ˆì§€, í—¤ë” ê¸°ë°˜ ì•Œê³ ë¦¬ì¦˜ ì„ íƒ ê¸ˆì§€
2. **í´ë ˆì„ ê²€ì¦**: `iss`, `aud`, `exp`, `nbf` í•„ìˆ˜ ê²€ì¦
3. **ì§§ì€ ë§Œë£Œ ì‹œê°„**: 15ë¶„ ì´í•˜ (OWASP ê¶Œì¥)
4. **í† í° ì‚¬ì´ë“œì¬í‚¹ ë°©ì–´**: httpOnly + Secure + SameSite ì¿ í‚¤
5. **í† í° ë¬´íš¨í™”**: ëª…ì‹œì  ë¡œê·¸ì•„ì›ƒ ì‹œ deny list ì‚¬ìš©
6. **ìµœì†Œ ê¶Œí•œ ì›ì¹™**: scope/role ìµœì†Œí™”

#### âš ï¸ ì¶”ê°€ ê¶Œì¥ì‚¬í•­

-   RS256 ì‚¬ìš© (HS256ë³´ë‹¤ ì•ˆì „)
-   ë¯¼ê° ì •ë³´ JWTì— ì €ì¥ ê¸ˆì§€
-   HTTPS ì „ìš© ì „ì†¡
-   ì£¼ê¸°ì  í† í° ë¡œí…Œì´ì…˜

### 3.2 Auth0 Best Practice

ì¶œì²˜: [Auth0 Token Best Practices](https://auth0.com/docs/secure/tokens/token-best-practices)

#### í† í° ì €ì¥ ì „ëµ

-   **ì›¹ ì•±**: httpOnly ì¿ í‚¤ (XSS ë°©ì–´)
-   **SPA**:
    -   âœ… **ê¶Œì¥**: ë¸Œë¼ìš°ì € ë©”ëª¨ë¦¬ + Web Worker (ìµœê³  ë³´ì•ˆ)
    -   âš ï¸ **ì°¨ì„ **: httpOnly ì¿ í‚¤ + Refresh Token Rotation
    -   âŒ **ê¸ˆì§€**: localStorage (XSS ì·¨ì•½)

#### Refresh Token Rotation

```
1. ë¡œê·¸ì¸ â†’ RT1 ë°œê¸‰ (httpOnly cookie)
2. RT1ë¡œ ê°±ì‹  â†’ RT2 ë°œê¸‰, RT1 ë¬´íš¨í™”
3. RT2ë¡œ ê°±ì‹  â†’ RT3 ë°œê¸‰, RT2 ë¬´íš¨í™”
...
```

**ë³´ì•ˆ íš¨ê³¼**:

-   íƒˆì·¨ëœ RT ì‚¬ìš© ì‹œ ìë™ ê°ì§€ (reuse detection)
-   ì „ì²´ í† í° íŒ¨ë°€ë¦¬ ë¬´íš¨í™”ë¡œ ê³µê²© ì°¨ë‹¨
-   63% ë” ì ì€ ë¬´ë‹¨ ì ‘ê·¼ ì‹œë„ (Auth0 í†µê³„)

### 3.3 OWASP CSRF ë°©ì–´

ì¶œì²˜: [OWASP CSRF Prevention](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html)

-   **SameSite=Strict**: ì™¸ë¶€ ì‚¬ì´íŠ¸ì—ì„œ ì¿ í‚¤ ì „ì†¡ ì°¨ë‹¨
-   **Double Submit Cookie**: ì¶”ê°€ CSRF í† í° ê²€ì¦
-   âš ï¸ **ì£¼ì˜**: XSSëŠ” ëª¨ë“  CSRF ë°©ì–´ ë¬´ë ¥í™” ê°€ëŠ¥

---

## 4. ë³´ì•ˆ ì·¨ì•½ì  ë¶„ì„ (CVE ì‚¬ë¡€)

### 4.1 JWT ë¼ì´ë¸ŒëŸ¬ë¦¬ ì·¨ì•½ì 

#### CVE-2022-23529 (JsonWebToken RCE)

-   **CVSS**: 7.6 (High)
-   **ì˜í–¥**: Remote Code Execution
-   **ì›ì¸**: `jwt.verify()`ì˜ `secretOrPublicKey` ë§¤ê°œë³€ìˆ˜ ì¡°ì‘
-   **êµí›ˆ**: ê²€ì¦ëœ JWT ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© í•„ìˆ˜

#### CVE-2018-1000531 (Algorithm Confusion)

-   **ê³µê²©**: `{"alg":"none"}` ì„œëª… ìš°íšŒ
-   **ì˜í–¥**: ê´€ë¦¬ì ê¶Œí•œ íƒˆì·¨
-   **ë°©ì–´**: ì•Œê³ ë¦¬ì¦˜ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ê°•ì œ

#### CVE-2015-9235 (HS256/RS256 í˜¼ë™)

-   **ê³µê²©**: RS256 â†’ HS256 ì „í™˜, ê³µê°œí‚¤ë¥¼ HMAC ë¹„ë°€í‚¤ë¡œ ì‚¬ìš©
-   **ì˜í–¥**: í† í° ìœ„ì¡°
-   **ë°©ì–´**: ì•Œê³ ë¦¬ì¦˜ í•˜ë“œì½”ë”©, í—¤ë” ì‹ ë¢° ê¸ˆì§€

### 4.2 XSS ê³µê²© ì‚¬ë¡€ (2024)

ì¶œì²˜: [InstaTunnel Blog - Real XSS Dangers in SPAs](https://instatunnel.my/blog/beyond-alert1-the-real-world-dangers-of-cross-site-scripting-xss-in-spas)

-   **Vue 2 Template Compiler**: CVE-2024-6783
-   **React/Vue SPA**: XSS ì·¨ì•½ì  ì§€ì† ë°œê²¬
-   **localStorage íƒˆì·¨**: ê³µê²©ìê°€ JavaScriptë¡œ í† í° ì½ê¸° ê°€ëŠ¥

**í†µê³„**:

-   2024ë…„ì—ë„ ë§ì€ í”„ë¡œë•ì…˜ ì‹œìŠ¤í…œì´ localStorage ì‚¬ìš© ì¤‘
-   XSS ë°©ì–´ ì‹¤íŒ¨ ì‹œ ì¦‰ê°ì ì¸ ê³„ì • íƒˆì·¨ ë°œìƒ

---

## 5. í† í° ì €ì¥ ë°©ì‹ ë¹„êµ

### 5.1 localStorage

| í•­ëª©              | í‰ê°€             | ì„¤ëª…                           |
| ----------------- | ---------------- | ------------------------------ |
| **XSS ë°©ì–´**      | âŒ **ë§¤ìš° ì·¨ì•½** | JavaScriptë¡œ ì¦‰ì‹œ ì ‘ê·¼ ê°€ëŠ¥    |
| **CSRF ë°©ì–´**     | âœ… ê¸°ë³¸ ë°©ì–´     | ì¿ í‚¤ ì•„ë‹ˆë¯€ë¡œ ìë™ ì „ì†¡ ì•ˆ ë¨  |
| **êµ¬í˜„ ë‚œì´ë„**   | âœ… ë§¤ìš° ì‰¬ì›€     | `localStorage.setItem()` í•œ ì¤„ |
| **ìš©ëŸ‰**          | âœ… ì¶©ë¶„ (5MB)    | í° JWTë„ ì €ì¥ ê°€ëŠ¥             |
| **ì„œë²„ ë¶€í•˜**     | âœ… ì—†ìŒ          | í´ë¼ì´ì–¸íŠ¸ë§Œ ê´€ë¦¬              |
| **ì¦‰ì‹œ ë¬´íš¨í™”**   | âŒ ë¶ˆê°€ëŠ¥        | í† í° ë§Œë£Œê¹Œì§€ ëŒ€ê¸°             |
| **ì¥ê¸° ìœ ì§€ë³´ìˆ˜** | âŒ ì–´ë ¤ì›€        | ë³´ì•ˆ ê¶Œê³  ìœ„ë°˜                 |

**ì´í‰**: ğŸ”´ **í”„ë¡œë•ì…˜ í™˜ê²½ ì‚¬ìš© ê¸ˆì§€** (OWASP, Auth0, ëª¨ë“  ë³´ì•ˆ ì „ë¬¸ê°€ ë™ì˜)

### 5.2 httpOnly Cookie

| í•­ëª©              | í‰ê°€              | ì„¤ëª…                         |
| ----------------- | ----------------- | ---------------------------- |
| **XSS ë°©ì–´**      | âœ… **ê°•ë ¥**       | JavaScript ì ‘ê·¼ ì°¨ë‹¨         |
| **CSRF ë°©ì–´**     | âš ï¸ ì¶”ê°€ ì‘ì—… í•„ìš” | SameSite=Strict + CSRF í† í°  |
| **êµ¬í˜„ ë‚œì´ë„**   | âš ï¸ ì¤‘ê°„           | ë°±ì—”ë“œ ì¿ í‚¤ ì„¤ì • + CORS ì„¤ì • |
| **ìš©ëŸ‰**          | âš ï¸ ì œí•œì  (4KB)   | í° JWTëŠ” ë¬¸ì œë  ìˆ˜ ìˆìŒ      |
| **ì„œë²„ ë¶€í•˜**     | âœ… ë‚®ìŒ           | ì¿ í‚¤ ì½ê¸°ë§Œ í•¨               |
| **ì¦‰ì‹œ ë¬´íš¨í™”**   | âš ï¸ ë¶€ë¶„ ê°€ëŠ¥      | Deny list êµ¬í˜„ ì‹œ ê°€ëŠ¥       |
| **ì¥ê¸° ìœ ì§€ë³´ìˆ˜** | âœ… ìš°ìˆ˜           | ì—…ê³„ í‘œì¤€                    |

**ì´í‰**: ğŸŸ¢ **ê¶Œì¥** (Auth0, OWASP ê³µì‹ ê¶Œì¥)

### 5.3 ë©”ëª¨ë¦¬ (JavaScript ë³€ìˆ˜ + Web Worker)

| í•­ëª©              | í‰ê°€               | ì„¤ëª…                              |
| ----------------- | ------------------ | --------------------------------- |
| **XSS ë°©ì–´**      | âœ… **ìµœê°•**        | ë©”ëª¨ë¦¬ë§Œ ì¡´ì¬, ì½ê¸° ì–´ë ¤ì›€        |
| **CSRF ë°©ì–´**     | âœ… ê¸°ë³¸ ë°©ì–´       | ì¿ í‚¤ ì•„ë‹ˆë¯€ë¡œ ìë™ ì „ì†¡ ì•ˆ ë¨     |
| **êµ¬í˜„ ë‚œì´ë„**   | ğŸ”´ **ë§¤ìš° ì–´ë ¤ì›€** | Web Worker + ë³µì¡í•œ ìƒíƒœ ê´€ë¦¬     |
| **ìš©ëŸ‰**          | âœ… ë¬´ì œí•œ          | ë©”ëª¨ë¦¬ í—ˆìš© ë²”ìœ„ ë‚´               |
| **ì„œë²„ ë¶€í•˜**     | âš ï¸ ì¦ê°€            | í˜ì´ì§€ ë¡œë“œë§ˆë‹¤ í† í° ì¬ë°œê¸‰       |
| **ì¦‰ì‹œ ë¬´íš¨í™”**   | âœ… ì™„ë²½            | íƒ­ ë‹«ìœ¼ë©´ ì¦‰ì‹œ ì‚­ì œ               |
| **ì¥ê¸° ìœ ì§€ë³´ìˆ˜** | âš ï¸ ë³µì¡            | SvelteKit ì—…ë°ì´íŠ¸ ì‹œ ì¬ì‘ì—… ìœ„í—˜ |

**ì´í‰**: ğŸŸ¡ **ìµœê³  ë³´ì•ˆì´ì§€ë§Œ ë³µì¡ë„ ë†’ìŒ** (Auth0 ìµœê³  ë³´ì•ˆ ê¶Œì¥)

### 5.4 ì„œë²„ ì„¸ì…˜ (Redis)

| í•­ëª©              | í‰ê°€              | ì„¤ëª…                        |
| ----------------- | ----------------- | --------------------------- |
| **XSS ë°©ì–´**      | âœ… **ê°•ë ¥**       | ì„¸ì…˜ IDë§Œ í´ë¼ì´ì–¸íŠ¸ì— ì €ì¥ |
| **CSRF ë°©ì–´**     | âš ï¸ ì¶”ê°€ ì‘ì—… í•„ìš” | SameSite=Strict + CSRF í† í° |
| **êµ¬í˜„ ë‚œì´ë„**   | âš ï¸ ì¤‘ê°„           | Redis ì„¸ì…˜ ìŠ¤í† ì–´ êµ¬ì¶•      |
| **ìš©ëŸ‰**          | âœ… ë¬´ì œí•œ         | ì„œë²„ ë©”ëª¨ë¦¬ í—ˆìš© ë²”ìœ„ ë‚´    |
| **ì„œë²„ ë¶€í•˜**     | ğŸ”´ **ë†’ìŒ**       | ë§¤ ìš”ì²­ë§ˆë‹¤ Redis ì¡°íšŒ      |
| **ì¦‰ì‹œ ë¬´íš¨í™”**   | âœ… **ì™„ë²½**       | Redisì—ì„œ ì„¸ì…˜ ì¦‰ì‹œ ì‚­ì œ    |
| **ì¥ê¸° ìœ ì§€ë³´ìˆ˜** | âœ… ìš°ìˆ˜           | ì „í†µì ì´ê³  ê²€ì¦ëœ ë°©ì‹      |

**ì´í‰**: ğŸŸ¢ **ì¦‰ì‹œ ë¬´íš¨í™”ê°€ ì¤‘ìš”í•˜ë©´ ìµœì„ ** (SvelteKit ê³µì‹ ê¶Œì¥)

---

## 6. ëŒ€ê¸°ì—… ì‚¬ë¡€ ë¶„ì„

### 6.1 Auth0 (ì¸ì¦ ì „ë¬¸ ê¸°ì—…)

**êµ¬í˜„ ë°©ì‹**:

-   **SPA**: Refresh Token Rotation + httpOnly Cookie
-   **Web Worker**: í† í°ì„ in-memory ì €ì¥ì†Œì— ê´€ë¦¬
-   **ìë™ ì¬ì‚¬ìš© ê°ì§€**: íƒˆì·¨ëœ RT ì‚¬ìš© ì‹œ ì „ì²´ íŒ¨ë°€ë¦¬ ë¬´íš¨í™”

**íŠ¹ì§•**:

-   SDK ì œê³µìœ¼ë¡œ ë³µì¡ë„ ê°ì†Œ
-   63% ë¬´ë‹¨ ì ‘ê·¼ ì‹œë„ ê°ì†Œ (í†µê³„)

### 6.2 Discord (ëŒ€ê·œëª¨ ì‹¤ì‹œê°„ ì»¤ë®¤ë‹ˆí‹°)

**ì•„í‚¤í…ì²˜**:

-   **WebSocket ê¸°ë°˜ ì„¸ì…˜ ê´€ë¦¬**
-   **Elixir/Erlang**: 1M+ ë™ì‹œ ì ‘ì† ì²˜ë¦¬
-   **ë¶„ì‚° ì„¸ì…˜**: Gateway â†’ Session Process â†’ WebSocket

**íŠ¹ì§•**:

-   100ë§Œëª… ë™ì‹œ ì ‘ì† ì„œë²„ ìš´ì˜
-   ë©”ì‹œì§€ ì „ë‹¬ ìµœì í™” (fan-out)
-   Redis + RabbitMQ + Kafka ì¡°í•©

### 6.3 Slack (ì—”í„°í”„ë¼ì´ì¦ˆ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜)

**ë³´ì•ˆ**:

-   **SSO (Single Sign-On)**
-   **2FA (Two-Factor Authentication)**
-   **ë°ì´í„° ì•”í˜¸í™”**: ì „ì†¡ ë° ì €ì¥ ëª¨ë‘

**íŠ¹ì§•**:

-   ë¬´ì œí•œ ì‚¬ìš©ì ì§€ì›
-   ì—”í„°í”„ë¼ì´ì¦ˆ ë³´ì•ˆ í‘œì¤€ ì¤€ìˆ˜

### 6.4 Google/Facebook OAuth

**ê¶Œì¥ì‚¬í•­** (Google Developers):

-   âœ… **ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© í•„ìˆ˜**: ì§ì ‘ JWT êµ¬í˜„ ê¸ˆì§€
-   âœ… **RS256 ì„œëª…**: ê³µê°œí‚¤ë¡œ ê²€ì¦
-   âœ… **Service Account**: JWT ìë™ ìƒì„±

---

## 7. SvelteKit íŠ¹í™” ê³ ë ¤ì‚¬í•­

### 7.1 ê³µì‹ ë¬¸ì„œ ê¶Œì¥

ì¶œì²˜: [SvelteKit Auth Docs](https://svelte.dev/docs/kit/auth)

> **Lucia ì°¸ê³  ê¶Œì¥**: ì„¸ì…˜ ê¸°ë°˜ ì›¹ ì•± ì¸ì¦
> **JWT ì£¼ì˜**: ë°ì´í„°ìŠ¤í† ì–´ ì²´í¬ ì—†ìœ¼ë¯€ë¡œ ì¦‰ì‹œ ë¬´íš¨í™” ë¶ˆê°€

### 7.2 ì»¤ë®¤ë‹ˆí‹° í•©ì˜ (2024)

-   **JWT ë‹¨ë… ì‚¬ìš©**: ì„±ëŠ¥ ìš°ì„ , ë¬´íš¨í™” ë¶ˆí•„ìš”í•œ ê²½ìš°
-   **ì„¸ì…˜ + Redis**: ë³´ì•ˆ ìš°ì„ , ì¦‰ì‹œ ë¬´íš¨í™” í•„ìš”
-   **í•˜ì´ë¸Œë¦¬ë“œ**: JWT (stateless) + Redis deny list

### 7.3 SvelteKit í™˜ê²½ íŠ¹ì„±

#### ì„œë²„ ì‚¬ì´ë“œ

-   `+server.ts`ì—ì„œ `cookies.set()` ì‚¬ìš©
-   `locals` ê°ì²´ë¡œ ìš”ì²­ ê°„ ë°ì´í„° ê³µìœ 
-   `hooks.server.ts`ì—ì„œ ì „ì—­ ì¸ì¦ ì²˜ë¦¬

#### í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ

-   `$app/stores`ì—ì„œ `page` ìŠ¤í† ì–´ ì ‘ê·¼
-   `fetch()`ëŠ” SvelteKitì´ ìë™ìœ¼ë¡œ ì¿ í‚¤ ì „ì†¡ (`credentials: 'include'`)
-   ë¸Œë¼ìš°ì € í™˜ê²½ ì²´í¬: `typeof window !== 'undefined'`

---

## 8. ì•„í‚¤í…ì²˜ ì˜µì…˜ ë¹„êµ

### Option A: JWT + httpOnly Cookie + Refresh Token Rotation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚                 â”‚   Server    â”‚
â”‚             â”‚                 â”‚   (Go)      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚                 â”‚             â”‚
â”‚  â”‚Memory â”‚  â”‚  accessToken    â”‚             â”‚
â”‚  â”‚  AT   â”‚â—„â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   Handler   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                 â”‚             â”‚
â”‚             â”‚                 â”‚             â”‚
â”‚  [httpOnly  â”‚  refreshToken   â”‚             â”‚
â”‚   Cookie]â—„â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   Service   â”‚
â”‚    RT       â”‚                 â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Rotation: RT1 â†’ RT2 â†’ RT3 ... (ìë™ ë¬´íš¨í™”)
```

**ì¥ì **:

-   âœ… XSS ë°©ì–´ (ATëŠ” ë©”ëª¨ë¦¬, RTëŠ” httpOnly)
-   âœ… CSRF ë°©ì–´ (SameSite=Strict)
-   âœ… í† í° íƒˆì·¨ ê°ì§€ (reuse detection)
-   âœ… Auth0 ê¶Œì¥ ë°©ì‹

**ë‹¨ì **:

-   âš ï¸ êµ¬í˜„ ë³µì¡ë„ ì¤‘ê°„
-   âš ï¸ RT ì¦‰ì‹œ ë¬´íš¨í™” ë¶ˆê°€ (deny list í•„ìš”)

**ì í•©í•œ ê²½ìš°**:

-   ëŒ€ë¶€ë¶„ì˜ SPA í”„ë¡œì íŠ¸
-   ì¥ê¸° ë¡œê·¸ì¸ ìœ ì§€ í•„ìš”
-   ì„œë²„ ë¶€í•˜ ìµœì†Œí™”

---

### Option B: ì„¸ì…˜ ê¸°ë°˜ (Redis + httpOnly Cookie)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚                 â”‚   Server    â”‚
â”‚             â”‚                 â”‚   (Go)      â”‚
â”‚  [httpOnly  â”‚  session_id     â”‚             â”‚
â”‚   Cookie]â—„â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   Handler   â”‚
â”‚  session_id â”‚                 â”‚      â†“      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚   [Redis]   â”‚
                                â”‚  {user_id,  â”‚
                                â”‚   role, ... }â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Session: ë§¤ ìš”ì²­ë§ˆë‹¤ Redis ì¡°íšŒ
```

**ì¥ì **:

-   âœ… ì¦‰ì‹œ ë¬´íš¨í™” ì™„ë²½ (Redis DEL)
-   âœ… ì „í†µì ì´ê³  ê²€ì¦ëœ ë°©ì‹
-   âœ… SvelteKit ê³µì‹ ê¶Œì¥ (Lucia)
-   âœ… í† í° í¬ê¸° ì œí•œ ì—†ìŒ

**ë‹¨ì **:

-   ğŸ”´ ë§¤ ìš”ì²­ë§ˆë‹¤ Redis ì¡°íšŒ (latency +5~10ms)
-   ğŸ”´ Redis ì¥ì•  ì‹œ ì„œë¹„ìŠ¤ ì¤‘ë‹¨
-   âš ï¸ ë¶„ì‚° í™˜ê²½ì—ì„œ ì„¸ì…˜ ë™ê¸°í™” í•„ìš”

**ì í•©í•œ ê²½ìš°**:

-   ê¸ˆìœµ/ì˜ë£Œ ë“± ë†’ì€ ë³´ì•ˆ í•„ìš”
-   ì¦‰ì‹œ ë¡œê·¸ì•„ì›ƒ í•„ìˆ˜
-   Redis ì¸í”„ë¼ ì´ë¯¸ êµ¬ì¶•ë¨

---

### Option C: í•˜ì´ë¸Œë¦¬ë“œ (JWT + Redis Deny List)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚                 â”‚   Server    â”‚
â”‚             â”‚                 â”‚   (Go)      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚  accessToken    â”‚             â”‚
â”‚  â”‚Memory â”‚â—„â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   Handler   â”‚
â”‚  â”‚  AT   â”‚  â”‚                 â”‚      â†“      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                 â”‚  JWT verify â”‚
â”‚             â”‚  refreshToken   â”‚      â†“      â”‚
â”‚  [httpOnly  â”‚                 â”‚   [Redis]   â”‚
â”‚   Cookie]â—„â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  deny_list  â”‚
â”‚    RT       â”‚                 â”‚ (logout only)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Normal: JWTë§Œ ê²€ì¦ (fast)
Logout: Redisì— í† í° ë“±ë¡ â†’ ì´í›„ ìš”ì²­ ì°¨ë‹¨
```

**ì¥ì **:

-   âœ… í‰ìƒì‹œ ë¹ ë¦„ (JWT stateless)
-   âœ… ë¡œê·¸ì•„ì›ƒ ì‹œ ì¦‰ì‹œ ë¬´íš¨í™” (Redis deny list)
-   âœ… Redis ì¥ì•  ì‹œì—ë„ ê¸°ë³¸ ë™ì‘ (graceful degradation)
-   âœ… ë‘ ë°©ì‹ì˜ ì¥ì  ê²°í•©

**ë‹¨ì **:

-   âš ï¸ êµ¬í˜„ ë³µì¡ë„ ë†’ìŒ
-   âš ï¸ Deny list ê´€ë¦¬ í•„ìš” (TTL ì„¤ì •)
-   âš ï¸ ë¡œê·¸ì•„ì›ƒ ì‹œì—ë§Œ ì¦‰ì‹œ ë¬´íš¨í™” (ê³„ì • ì •ì§€ëŠ” ëŠë¦¼)

**ì í•©í•œ ê²½ìš°**:

-   ì„±ëŠ¥ê³¼ ë³´ì•ˆ ëª¨ë‘ ì¤‘ìš”
-   Redis ì´ë¯¸ ì‚¬ìš© ì¤‘
-   ë¡œê·¸ì•„ì›ƒ ì¦‰ì‹œ ì²˜ë¦¬ í•„ìš”

---

## 9. ìµœì¢… ì¶”ì²œì•ˆ (3ê°€ì§€ ì˜µì…˜)

### ğŸ¥‡ 1ìˆœìœ„: Option C (í•˜ì´ë¸Œë¦¬ë“œ)

**ì´ìœ **:

1. **í˜„ì¬ ì¸í”„ë¼ í™œìš©**: Redis ì´ë¯¸ ì—°ê²°ë˜ì–´ ìˆìŒ
2. **ì„±ëŠ¥ ìš°ì„ **: í‰ìƒì‹œ JWT stateless (50ms ëª©í‘œ ë‹¬ì„± ê°€ëŠ¥)
3. **ë³´ì•ˆ ê°•í™”**: ë¡œê·¸ì•„ì›ƒ ì¦‰ì‹œ ë¬´íš¨í™” (deny list)
4. **í™•ì¥ì„±**: 7ì²œ~2ë§Œëª… ë™ì‹œ ì ‘ì† ëŒ€ì‘ ê°€ëŠ¥
5. **ì¥ê¸° ìœ ì§€ë³´ìˆ˜**: ì—…ê³„ Best Practice + ì»¤ìŠ¤í„°ë§ˆì´ì§•

**êµ¬í˜„ ë‹¨ê³„**:

```
Phase 1: JWT + httpOnly Cookie ê¸°ë³¸ êµ¬ì¡° (Option A)
Phase 2: Redis Deny List ì¶”ê°€ (Option C ì™„ì„±)
Phase 3: Refresh Token Rotation ì¶”ê°€ (ë³´ì•ˆ ê°•í™”)
```

**ì˜ˆìƒ ì„±ëŠ¥**:

-   í‰ìƒì‹œ: JWT ê²€ì¦ë§Œ â†’ **2~5ms**
-   ë¡œê·¸ì•„ì›ƒ: Redis SET â†’ **+5~10ms** (ì¼íšŒì„±)
-   ëª©í‘œ 50ms ë‹¬ì„± âœ…

---

### ğŸ¥ˆ 2ìˆœìœ„: Option A (JWT + Rotation)

**ì´ìœ **:

1. **êµ¬í˜„ ë‹¨ìˆœ**: ë°±ì—”ë“œ ìˆ˜ì • ìµœì†Œí™”
2. **Auth0 í‘œì¤€**: ê²€ì¦ëœ ë°©ì‹
3. **Redis ë¶ˆí•„ìš”**: ì´ˆê¸° ì¸í”„ë¼ ë‹¨ìˆœ

**ë‹¨ì **:

-   ë¡œê·¸ì•„ì›ƒ ì¦‰ì‹œ ë¬´íš¨í™” ë¶ˆê°€ (ìµœëŒ€ 15ë¶„ ì§€ì—°)
-   ê³„ì • ì •ì§€ ì‹œ í† í° ë§Œë£Œê¹Œì§€ ì ‘ê·¼ ê°€ëŠ¥

**ì í•©í•œ ê²½ìš°**:

-   Redis ë¯¸ì‚¬ìš© ê²°ì • ì‹œ
-   ë¹ ë¥¸ êµ¬í˜„ ìš°ì„ 

---

### ğŸ¥‰ 3ìˆœìœ„: Option B (ì„¸ì…˜ + Redis)

**ì´ìœ **:

1. **ìµœê³  ë³´ì•ˆ**: ì¦‰ì‹œ ë¬´íš¨í™” ì™„ë²½
2. **SvelteKit ê³µì‹ ê¶Œì¥**: Lucia íŒ¨í„´
3. **ì „í†µì  ë°©ì‹**: ìœ ì§€ë³´ìˆ˜ ìš©ì´

**ë‹¨ì **:

-   **ì¹˜ëª…ì  ì„±ëŠ¥ ë¬¸ì œ**: ë§¤ ìš”ì²­ë§ˆë‹¤ Redis ì¡°íšŒ (+10ms)
-   7ì²œ~2ë§Œëª… ë™ì‹œ ì ‘ì† ì‹œ Redis ë¶€í•˜ ì¦ê°€
-   50ms ëª©í‘œ ë‹¬ì„± ì–´ë ¤ì›€

**ì í•©í•œ ê²½ìš°**:

-   ê¸ˆìœµê¶Œ ìˆ˜ì¤€ ë³´ì•ˆ í•„ìš”
-   ì„±ëŠ¥ë³´ë‹¤ ë³´ì•ˆ ìš°ì„ 

---

## 10. êµ¬í˜„ ë¡œë“œë§µ

### Phase 1: ê¸°ë³¸ êµ¬ì¡° (Option A â†’ 1ì£¼)

#### ë°±ì—”ë“œ (Go)

1. **ë¡œê·¸ì¸ í•¸ë“¤ëŸ¬ ìˆ˜ì •**

    - httpOnly ì¿ í‚¤ë¡œ refreshToken ì„¤ì •
    - ì‘ë‹µì—ì„œ refreshToken ì œê±°
    - Secure + SameSite=Strict ì„¤ì •

2. **ë¦¬í”„ë ˆì‹œ í•¸ë“¤ëŸ¬ ìˆ˜ì •**

    - ì¿ í‚¤ì—ì„œ refreshToken ì½ê¸°
    - ìƒˆ refreshToken ì¿ í‚¤ë¡œ ë°˜í™˜ (Rotation)

3. **ë¡œê·¸ì•„ì›ƒ í•¸ë“¤ëŸ¬ ì¶”ê°€**

    - refreshToken ì¿ í‚¤ ì‚­ì œ
    - MaxAge=-1 ì„¤ì •

4. **CORS ì„¤ì •**
    - `AllowCredentials: true` ì¶”ê°€
    - Origin í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ì„¤ì •

#### í”„ë¡ íŠ¸ì—”ë“œ (SvelteKit)

1. **SecureApiClient í´ë˜ìŠ¤**

    - accessToken ë©”ëª¨ë¦¬ ì €ì¥
    - ìë™ í† í° ê°±ì‹  (5ë¶„ ì „)
    - 401 ì—ëŸ¬ ì‹œ ë¦¬í”„ë ˆì‹œ ì¬ì‹œë„

2. **localStorage ì œê±°**

    - ê¸°ì¡´ í† í° ì €ì¥ ì½”ë“œ ì‚­ì œ
    - ì¿ í‚¤ë¡œë§Œ ì¸ì¦

3. **fetch ì˜µì…˜ ì¶”ê°€**
    - `credentials: 'include'` ì „ì—­ ì„¤ì •

#### í…ŒìŠ¤íŠ¸

-   ë¡œê·¸ì¸ â†’ í† í° ê°±ì‹  â†’ ë¡œê·¸ì•„ì›ƒ í”Œë¡œìš°
-   XSS ì‹œë®¬ë ˆì´ì…˜ (í† í° ì½ê¸° ì‹œë„)
-   CSRF ì‹œë®¬ë ˆì´ì…˜ (ì™¸ë¶€ ì‚¬ì´íŠ¸ì—ì„œ ìš”ì²­)

---

### Phase 2: Redis Deny List ì¶”ê°€ (Option C â†’ 3ì¼)

#### ë°±ì—”ë“œ

1. **Redis í´ë¼ì´ì–¸íŠ¸ ì„¤ì •**

    ```go
    // pkg/redis/deny_list.go
    func AddToDenyList(tokenID string, ttl time.Duration) error {
        return rdb.Set(ctx, "deny:"+tokenID, "1", ttl).Err()
    }

    func IsInDenyList(tokenID string) bool {
        val, _ := rdb.Get(ctx, "deny:"+tokenID).Result()
        return val != ""
    }
    ```

2. **JWT ë¯¸ë“¤ì›¨ì–´ ìˆ˜ì •**

    ```go
    func JWTAuth() fiber.Handler {
        return func(c *fiber.Ctx) error {
            claims := extractClaims(c)

            // Deny list ì²´í¬
            if redis.IsInDenyList(claims.JTI) {
                return c.Status(401).JSON(...)
            }

            return c.Next()
        }
    }
    ```

3. **ë¡œê·¸ì•„ì›ƒ í•¸ë“¤ëŸ¬ ìˆ˜ì •**

    ```go
    func Logout(c *fiber.Ctx) error {
        claims := extractClaims(c)

        // accessTokenì„ deny listì— ì¶”ê°€ (ë‚¨ì€ TTLë§Œí¼)
        ttl := claims.ExpiresAt.Time.Sub(time.Now())
        redis.AddToDenyList(claims.JTI, ttl)

        // ì¿ í‚¤ ì‚­ì œ
        c.Cookie(&fiber.Cookie{Name: "damoang_refresh_token", MaxAge: -1})

        return c.JSON(...)
    }
    ```

#### í…ŒìŠ¤íŠ¸

-   ë¡œê·¸ì•„ì›ƒ í›„ ì¦‰ì‹œ API í˜¸ì¶œ â†’ 401 í™•ì¸
-   Redis ì¥ì•  ì‹œë®¬ë ˆì´ì…˜ â†’ graceful degradation í™•ì¸

---

### Phase 3: Refresh Token Rotation ê°•í™” (Option C ì™„ì„± â†’ 2ì¼)

#### ë°±ì—”ë“œ

1. **Reuse Detection**

    ```go
    // Redisì— ì‚¬ìš©ëœ RT ì €ì¥ (ì§§ì€ TTL)
    func MarkRefreshTokenUsed(tokenID string) {
        rdb.Set(ctx, "used_rt:"+tokenID, "1", 10*time.Second)
    }

    func IsRefreshTokenReused(tokenID string) bool {
        val, _ := rdb.Get(ctx, "used_rt:"+tokenID).Result()
        return val != ""
    }
    ```

2. **ë¦¬í”„ë ˆì‹œ í•¸ë“¤ëŸ¬ ìˆ˜ì •**

    ```go
    func RefreshToken(c *fiber.Ctx) error {
        claims := extractClaims(c)

        // âœ… Reuse detection
        if redis.IsRefreshTokenReused(claims.JTI) {
            // ì „ì²´ í† í° íŒ¨ë°€ë¦¬ ë¬´íš¨í™”
            redis.InvalidateTokenFamily(claims.FamilyID)
            return c.Status(401).JSON(...)
        }

        // RT ì‚¬ìš© í‘œì‹œ
        redis.MarkRefreshTokenUsed(claims.JTI)

        // ìƒˆ AT, RT ë°œê¸‰
        newTokens := service.RefreshToken(...)

        return c.JSON(...)
    }
    ```

#### í”„ë¡ íŠ¸ì—”ë“œ

-   ë³€ê²½ ì—†ìŒ (ì„œë²„ê°€ ìë™ ì²˜ë¦¬)

#### ëª¨ë‹ˆí„°ë§

-   Reuse detection ë°œìƒ ë¡œê·¸
-   ë¬´íš¨í™”ëœ í† í° íŒ¨ë°€ë¦¬ í†µê³„

---

### Phase 4: ë³´ì•ˆ í…ŒìŠ¤íŠ¸ ë° ìµœì í™” (1ì£¼)

#### ë³´ì•ˆ í…ŒìŠ¤íŠ¸

1. **OWASP ZAP** ìë™ ìŠ¤ìº”
2. **Burp Suite** ìˆ˜ë™ í…ŒìŠ¤íŠ¸
3. **XSS ì‹œë®¬ë ˆì´ì…˜**

    ```javascript
    // ê°œë°œì ë„êµ¬ì—ì„œ ì‹¤í–‰
    console.log(localStorage.getItem('damoang_api_token')); // nullì´ì–´ì•¼ í•¨
    document.cookie; // httpOnlyì´ë¯€ë¡œ RT ë³´ì´ì§€ ì•Šì•„ì•¼ í•¨
    ```

4. **CSRF ì‹œë®¬ë ˆì´ì…˜**
    ```html
    <!-- ì™¸ë¶€ ì‚¬ì´íŠ¸ì—ì„œ -->
    <form action="https://damoang.net/api/v2/posts" method="POST">
        <!-- SameSite=Strictë¡œ ì°¨ë‹¨ë˜ì–´ì•¼ í•¨ -->
    </form>
    ```

#### ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

-   **JMeter**: 2ë§Œëª… ë™ì‹œ ì ‘ì† ì‹œë®¬ë ˆì´ì…˜
-   **ëª©í‘œ**: ì‘ë‹µ ì‹œê°„ 50ms ì´í•˜ ìœ ì§€
-   **Redis ëª¨ë‹ˆí„°ë§**: ì´ˆë‹¹ ì¿¼ë¦¬ ìˆ˜, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰

#### ìµœì í™”

-   JWT í˜ì´ë¡œë“œ ìµœì†Œí™” (claim ì¤„ì´ê¸°)
-   Redis Connection Pool íŠœë‹
-   Nginx ìºì‹± ì„¤ì •

---

## 11. ì˜ì‚¬ê²°ì • ì²´í¬ë¦¬ìŠ¤íŠ¸

### âœ… Option C (í•˜ì´ë¸Œë¦¬ë“œ) ì„ íƒ ì‹œ

#### ì¥ì  í™•ì¸

-   [ ] Redis ì´ë¯¸ êµ¬ì¶•ë˜ì–´ ìˆìŒ
-   [ ] 50ms ì‘ë‹µ ì‹œê°„ ëª©í‘œ ë‹¬ì„± ê°€ëŠ¥
-   [ ] ë¡œê·¸ì•„ì›ƒ ì¦‰ì‹œ ë¬´íš¨í™” í•„ìš”
-   [ ] 2ë§Œëª… ë™ì‹œ ì ‘ì† ëª©í‘œ (ì„±ëŠ¥ ì¤‘ìš”)
-   [ ] ì¥ê¸° ìœ ì§€ë³´ìˆ˜ ê³ ë ¤ (10ë…„ ì´ìƒ)

#### ë‹¨ì  ìˆ˜ìš© ê°€ëŠ¥ ì—¬ë¶€

-   [ ] êµ¬í˜„ ë³µì¡ë„ ë†’ìŒ (3ì£¼ ì‘ì—…)
-   [ ] Redis ì˜ì¡´ì„± ì¦ê°€ (ê´€ë¦¬ í¬ì¸íŠ¸ ì¦ê°€)
-   [ ] Deny list TTL ê´€ë¦¬ í•„ìš”

#### ëŒ€ì•ˆ ê²€í† 

-   Option A: ë” ë‹¨ìˆœí•˜ì§€ë§Œ ì¦‰ì‹œ ë¬´íš¨í™” ë¶ˆê°€
-   Option B: ë” ì•ˆì „í•˜ì§€ë§Œ ì„±ëŠ¥ ë¬¸ì œ

---

### âš ï¸ Option A ì„ íƒ ì‹œ

#### ì¥ì  í™•ì¸

-   [ ] ë¹ ë¥¸ êµ¬í˜„ (1ì£¼)
-   [ ] Redis ì˜ì¡´ì„± ì—†ìŒ
-   [ ] Auth0 í‘œì¤€ ë°©ì‹

#### ë‹¨ì  ìˆ˜ìš© ê°€ëŠ¥ ì—¬ë¶€

-   [ ] ë¡œê·¸ì•„ì›ƒ í›„ ìµœëŒ€ 15ë¶„ê°„ í† í° ìœ íš¨ (ë³´ì•ˆ ìœ„í—˜)
-   [ ] ê³„ì • ì •ì§€ ì‹œ ì¦‰ì‹œ ì°¨ë‹¨ ë¶ˆê°€
-   [ ] í–¥í›„ Option Cë¡œ ì—…ê·¸ë ˆì´ë“œ í•„ìš” ì‹œ ì¬ì‘ì—…

---

### ğŸ”´ Option B ì„ íƒ ì‹œ

#### ì¥ì  í™•ì¸

-   [ ] ìµœê³  ë³´ì•ˆ (ì¦‰ì‹œ ë¬´íš¨í™” ì™„ë²½)
-   [ ] SvelteKit ê³µì‹ ê¶Œì¥ íŒ¨í„´

#### ë‹¨ì  ìˆ˜ìš© ê°€ëŠ¥ ì—¬ë¶€

-   [ ] ë§¤ ìš”ì²­ë§ˆë‹¤ Redis ì¡°íšŒ (+10ms latency)
-   [ ] 50ms ëª©í‘œ ë‹¬ì„± ì–´ë ¤ì›€
-   [ ] Redis ì¥ì•  = ì„œë¹„ìŠ¤ ì¤‘ë‹¨

#### ì„±ëŠ¥ ëª©í‘œ ì¬ê²€í† 

-   50ms â†’ 100msë¡œ ì™„í™” ê°€ëŠ¥í•œê°€?
-   Redis ê³ ê°€ìš©ì„± êµ¬ì¶• ë¹„ìš© ê°ë‹¹ ê°€ëŠ¥í•œê°€?

---

## 12. ì°¸ê³  ìë£Œ

### OWASP

-   [JWT Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/JSON_Web_Token_for_Java_Cheat_Sheet.html)
-   [CSRF Prevention](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html)
-   [REST Security](https://cheatsheetseries.owasp.org/cheatsheets/REST_Security_Cheat_Sheet.html)

### Auth0

-   [Token Best Practices](https://auth0.com/docs/secure/tokens/token-best-practices)
-   [Refresh Token Rotation](https://auth0.com/docs/secure/tokens/refresh-tokens/refresh-token-rotation)
-   [JWT Best Practices](https://curity.io/resources/learn/jwt-best-practices/)

### SvelteKit

-   [Official Auth Docs](https://svelte.dev/docs/kit/auth)
-   [Lucia (Session Library)](https://lucia-auth.com/)

### CVE ë°ì´í„°ë² ì´ìŠ¤

-   [CVE-2022-23529](https://unit42.paloaltonetworks.com/jsonwebtoken-vulnerability-cve-2022-23529/)
-   [JWT Vulnerabilities](https://debricked.com/blog/json-web-tokens/)

### ëŒ€ê¸°ì—… ì‚¬ë¡€

-   [Discord Architecture](https://www.infoq.com/news/2024/01/discord-midjourney-performance/)
-   [Google OAuth Best Practice](https://developers.google.com/identity/protocols/oauth2)

---

## 13. ê²°ë¡  ë° ì¶”ì²œ

### ìµœì¢… ì¶”ì²œ: **Option C (í•˜ì´ë¸Œë¦¬ë“œ)** ğŸ†

**ê·¼ê±°**:

1. **ì„±ëŠ¥ ëª©í‘œ ë‹¬ì„±**: 50ms ì´í•˜ ìœ ì§€ ê°€ëŠ¥
2. **ë³´ì•ˆ ê°•í™”**: ë¡œê·¸ì•„ì›ƒ ì¦‰ì‹œ ë¬´íš¨í™”
3. **ì¸í”„ë¼ í™œìš©**: Redis ì´ë¯¸ ì¤€ë¹„ë¨
4. **í™•ì¥ì„±**: 2ë§Œëª… ë™ì‹œ ì ‘ì† ëŒ€ì‘
5. **ì¥ê¸° ìœ ì§€ë³´ìˆ˜**: ì—…ê³„ Best Practice ê¸°ë°˜
6. **ì ì§„ì  êµ¬í˜„**: Phase 1 (Option A) â†’ Phase 2 (Option C)

### êµ¬í˜„ ìš°ì„ ìˆœìœ„

**ì¦‰ì‹œ ì‹œì‘ (Phase 1)**:

-   âœ… JWT + httpOnly Cookie ê¸°ë³¸ êµ¬ì¡°
-   âœ… localStorage ì œê±°
-   âœ… Refresh Token Rotation

**2ì£¼ ë‚´ (Phase 2)**:

-   âœ… Redis Deny List ì¶”ê°€
-   âœ… ë¡œê·¸ì•„ì›ƒ ì¦‰ì‹œ ë¬´íš¨í™”

**1ê°œì›” ë‚´ (Phase 3-4)**:

-   âœ… Reuse Detection ê°•í™”
-   âœ… ë³´ì•ˆ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
-   âœ… ì„±ëŠ¥ ìµœì í™”

### ì„±ê³µ ì§€í‘œ

**ë³´ì•ˆ**:

-   [ ] XSS ê³µê²© ì‹œ í† í° íƒˆì·¨ ë¶ˆê°€
-   [ ] CSRF ê³µê²© ì°¨ë‹¨ í™•ì¸
-   [ ] ë¡œê·¸ì•„ì›ƒ í›„ 1ì´ˆ ë‚´ API ì°¨ë‹¨

**ì„±ëŠ¥**:

-   [ ] í‰ê·  ì‘ë‹µ ì‹œê°„ < 50ms
-   [ ] 2ë§Œëª… ë™ì‹œ ì ‘ì† ì‹œ ì•ˆì •ì„±
-   [ ] Redis ì¡°íšŒ < 5ms

**ìœ ì§€ë³´ìˆ˜**:

-   [ ] OWASP ì²´í¬ë¦¬ìŠ¤íŠ¸ 100% ì¤€ìˆ˜
-   [ ] ìë™í™”ëœ ë³´ì•ˆ í…ŒìŠ¤íŠ¸ êµ¬ì¶•
-   [ ] ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ êµ¬ì¶•

---

**ë‹¤ìŒ ë‹¨ê³„**: ì‚¬ìš©ì ìŠ¹ì¸ í›„ Phase 1 êµ¬í˜„ ì‹œì‘
